From 87ce8b1bc695a5a1afa3cf16aa70d25010eddcbf Mon Sep 17 00:00:00 2001
From: Juho Kilpikoski <juho.kilpikoski@iki.fi>
Date: Tue, 30 Mar 2010 12:49:19 +0300
Subject: [PATCH 3/3] Refactor to use event_instances

---
 .../app/controllers/event_instances_controller.rb  |   23 ++++++++++++++
 .../app/controllers/events_controller.rb           |    1 +
 milloinviimeksi/app/models/event_instance.rb       |    3 ++
 .../app/views/event_instances/index.html.erb       |   31 ++++++++++++++++++++
 milloinviimeksi/app/views/events/index.html.erb    |   31 +++++++++++--------
 milloinviimeksi/app/views/events/new.html.erb      |    6 +---
 milloinviimeksi/app/views/events/show.html.erb     |    2 +-
 milloinviimeksi/config/routes.rb                   |    1 +
 .../20100329123847_remove_time_from_events.rb      |    9 ++++++
 .../20100329124741_create_event_instances.rb       |   14 +++++++++
 milloinviimeksi/db/schema.rb                       |   10 +++++-
 11 files changed, 110 insertions(+), 21 deletions(-)
 create mode 100755 milloinviimeksi/app/controllers/event_instances_controller.rb
 create mode 100755 milloinviimeksi/app/models/event_instance.rb
 create mode 100755 milloinviimeksi/app/views/event_instances/index.html.erb
 create mode 100755 milloinviimeksi/db/migrate/20100329123847_remove_time_from_events.rb
 create mode 100755 milloinviimeksi/db/migrate/20100329124741_create_event_instances.rb

diff --git a/milloinviimeksi/app/controllers/event_instances_controller.rb b/milloinviimeksi/app/controllers/event_instances_controller.rb
new file mode 100755
index 0000000..1d0bf1f
--- /dev/null
+++ b/milloinviimeksi/app/controllers/event_instances_controller.rb
@@ -0,0 +1,23 @@
+class EventInstancesController < ApplicationController
+  
+  def index
+    @event_instances = EventInstance.all
+    @event_instance = EventInstance.new
+  end
+
+  def show
+    @event_instance = EventInstance.find(params[:id])
+  end
+
+  def create
+    @event_instance = EventInstance.new(params[:event_instance])
+
+    if @event_instance.save
+      flash[:notice] = 'Event instance was successfully created.'
+      redirect_to(@event_instance)
+    else
+      render :action => "new" 
+    end
+  end
+  
+end
\ No newline at end of file
diff --git a/milloinviimeksi/app/controllers/events_controller.rb b/milloinviimeksi/app/controllers/events_controller.rb
index 71fc475..8ab9262 100755
--- a/milloinviimeksi/app/controllers/events_controller.rb
+++ b/milloinviimeksi/app/controllers/events_controller.rb
@@ -2,6 +2,7 @@ class EventsController < ApplicationController
 
   def index
     @events = Event.all
+    @event = Event.new
   end
 
   def show
diff --git a/milloinviimeksi/app/models/event_instance.rb b/milloinviimeksi/app/models/event_instance.rb
new file mode 100755
index 0000000..420b381
--- /dev/null
+++ b/milloinviimeksi/app/models/event_instance.rb
@@ -0,0 +1,3 @@
+class EventInstance < ActiveRecord::Base
+  belongs_to :event
+end
diff --git a/milloinviimeksi/app/views/event_instances/index.html.erb b/milloinviimeksi/app/views/event_instances/index.html.erb
new file mode 100755
index 0000000..e6b104f
--- /dev/null
+++ b/milloinviimeksi/app/views/event_instances/index.html.erb
@@ -0,0 +1,31 @@
+<h1>Add new event instance</h1>
+
+<% form_for(@event_instance) do |instance| %>
+  <%= instance.error_messages %>
+  
+<% # valitse instanssi %>
+
+  <p>
+    <%= instance.label :time %><br />
+    <%= instance.datetime_select :time %>
+  </p>
+  <p>
+    <%= instance.submit 'Create' %>
+  </p>
+<% end %>
+
+<h1>Listing event instances</h1>
+
+<table>
+  <tr>
+    <th>Name</th>
+    <th>Time</th>
+  </tr>
+
+<% @event_instances.each do |event_instance| %>
+  <tr>
+    <td><%=h event_instance.event.name %></td>
+    <td><%=h event_instance.time.strftime("%d.%m.%Y %H:%M") %></td>
+  </tr>
+<% end %>
+</table>
\ No newline at end of file
diff --git a/milloinviimeksi/app/views/events/index.html.erb b/milloinviimeksi/app/views/events/index.html.erb
index bf48a5a..480b1e5 100755
--- a/milloinviimeksi/app/views/events/index.html.erb
+++ b/milloinviimeksi/app/views/events/index.html.erb
@@ -1,19 +1,24 @@
-<h1>Listing events</h1>
+<h1>When did you...</h1>
 
-<table>
-  <tr>
-    <th>Name</th>
-    <th>Time</th>
-  </tr>
+<ul>
 
 <% @events.each do |event| %>
-  <tr>
-    <td><%=h event.name %></td>
-    <td><%=h event.time.strftime("%d.%m.%Y %H:%M") %></td>
-  </tr>
+  <li>
+    <h2><%= link_to event.name, event %></h2>
+    <p>[Luo instanssi]</p>
+  </li>
 <% end %>
-</table>
+<li>
+    <% form_for(@event) do |f| %>
+      <p>
+        <%= f.text_field :name, {:placeholder => 'Create a new event?'}%>
+        <%= f.submit 'Create' %>
+      </p>
+    <% end %>
+    
+</li>
+</ul>
 
-<br />
 
-<%= link_to 'New event', new_event_path %>
\ No newline at end of file
+
+<!--<%= link_to 'New event', new_event_path %>-->
\ No newline at end of file
diff --git a/milloinviimeksi/app/views/events/new.html.erb b/milloinviimeksi/app/views/events/new.html.erb
index b83f3dd..1e6e600 100755
--- a/milloinviimeksi/app/views/events/new.html.erb
+++ b/milloinviimeksi/app/views/events/new.html.erb
@@ -1,17 +1,13 @@
 <h1>New event</h1>
 
 <% form_for(@event) do |f| %>
-  <%= f.error_messages %>
+  <%= f.error_messages({:class => 'error'})%>
 
   <p>
     <%= f.label :name %><br />
     <%= f.text_field :name %>
   </p>
   <p>
-    <%= f.label :time %><br />
-    <%= f.datetime_select :time %>
-  </p>
-  <p>
     <%= f.submit 'Create' %>
   </p>
 <% end %>
diff --git a/milloinviimeksi/app/views/events/show.html.erb b/milloinviimeksi/app/views/events/show.html.erb
index 528d0fb..621158a 100755
--- a/milloinviimeksi/app/views/events/show.html.erb
+++ b/milloinviimeksi/app/views/events/show.html.erb
@@ -5,7 +5,7 @@
 
 <p>
   <b>Time:</b>
-  <%=h @event.time.strftime("%d.%m.%Y %H:%M") %>
+
 </p>
 
 <%= link_to 'Back', events_path %>
\ No newline at end of file
diff --git a/milloinviimeksi/config/routes.rb b/milloinviimeksi/config/routes.rb
index 062896b..9a08303 100755
--- a/milloinviimeksi/config/routes.rb
+++ b/milloinviimeksi/config/routes.rb
@@ -44,5 +44,6 @@ ActionController::Routing::Routes.draw do |map|
   map.resource :session
   map.resources :users
   map.resources :events
+  map.resources :event_instances
   map.root :controller => :events
 end
diff --git a/milloinviimeksi/db/migrate/20100329123847_remove_time_from_events.rb b/milloinviimeksi/db/migrate/20100329123847_remove_time_from_events.rb
new file mode 100755
index 0000000..6534413
--- /dev/null
+++ b/milloinviimeksi/db/migrate/20100329123847_remove_time_from_events.rb
@@ -0,0 +1,9 @@
+class RemoveTimeFromEvents < ActiveRecord::Migration
+  def self.up
+    remove_column :events, :time
+  end
+
+  def self.down
+    add_column :events, :time, :timestamp
+  end
+end
diff --git a/milloinviimeksi/db/migrate/20100329124741_create_event_instances.rb b/milloinviimeksi/db/migrate/20100329124741_create_event_instances.rb
new file mode 100755
index 0000000..0e8479f
--- /dev/null
+++ b/milloinviimeksi/db/migrate/20100329124741_create_event_instances.rb
@@ -0,0 +1,14 @@
+class CreateEventInstances < ActiveRecord::Migration
+  def self.up
+    create_table :event_instances do |t|
+      t.integer :event_id
+      t.timestamp :time
+
+      t.timestamps
+    end
+  end
+
+  def self.down
+    drop_table :event_instances
+  end
+end
diff --git a/milloinviimeksi/db/schema.rb b/milloinviimeksi/db/schema.rb
index 8f6b612..e4f0630 100644
--- a/milloinviimeksi/db/schema.rb
+++ b/milloinviimeksi/db/schema.rb
@@ -9,11 +9,17 @@
 #
 # It's strongly recommended to check this file into your version control system.
 
-ActiveRecord::Schema.define(:version => 20100328152048) do
+ActiveRecord::Schema.define(:version => 20100329124741) do
+
+  create_table "event_instances", :force => true do |t|
+    t.integer  "event_id"
+    t.datetime "time"
+    t.datetime "created_at"
+    t.datetime "updated_at"
+  end
 
   create_table "events", :force => true do |t|
     t.string   "name"
-    t.datetime "time"
     t.datetime "created_at"
     t.datetime "updated_at"
   end
-- 
1.7.0.3

